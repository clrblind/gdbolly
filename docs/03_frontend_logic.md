# Внутреннее устройство Фронтенда (React/Redux)

## 1. Архитектура и Рефакторинг (v0.0.7)
Фронтенд прошел глубокий рефакторинг для разделения логики и представления. Монолитный код `App.jsx` был разбит на специализированные кастомные хуки.

### 1.1. Структура Хуков (`src/hooks/`)
Логика приложения декомпозирована на следующие модули:

*   **`useAppLogic.js`**: Агрегатор. Инициализирует все остальные хуки и предоставляет единый интерфейс для `App.jsx`.
*   **`useAPI.js`**: Обертка над `fetch`. Отвечает за отправку HTTP запросов и — *важно* — за логирование запросов и ответов в Redux Store (`addSystemLog`).
*   **`useSocket.js`**: Управляет WebSocket соединением. Слушает сообщения (`status`, `registers`, `disassembly`) и диспатчит соответствующие экшены Redux.
*   **`useDebuggerControl.js`**: Логика управления исполнением (`Step`, `Run`, `Pause`) и навигации (`Goto`, `Jump to RIP`). Обрабатывает глобальные горячие клавиши (F7-F9, F12).
*   **`useMemory.js`**: Самый массивный хук. Управляет:
    *   Контекстным меню дизассемблера.
    *   Патчингом памяти (Edit, Fill).
    *   Комментариями.
    *   Копированием в буфер обмена.
    *   Операцией Revert (откат).
*   **`useLayout.js`**: Логика изменения размеров панелей (Resizers).

## 2. Управление Состоянием (Redux: `debuggerSlice.js`)

### 2.1. Важные поля состояния
*   **`systemLogs`**: Массив объектов `{id, timestamp, message, type}`. Хранит историю событий.
*   **`viewStartAddress`**: Адрес первой видимой инструкции в листинге. **Важно**: Это поле отвязано от регистра `RIP`. `RIP` показывает, где исполнение, а `viewStartAddress` — что смотрит пользователь. Синхронизация происходит только при остановке отладки или ручном переходе.
*   **`modifiedAddresses`**: Список нормализованных адресов, которые были изменены. Используется `DisassemblyPane` для отрисовки красного текста на черном фоне.
*   **`showSystemLog`**: Булевый флаг. Если `true`, интерфейс переключается в режим полноэкранного лога.

### 2.2. Нормализация Адресов (`utils/addressUtils.js`)
Одна из частых проблем при работе с GDB — формат адресов. GDB может вернуть `0x401000`, `0x00401000` или `4198400` (dec).
Утилита `normalizeAddress` приводит все адреса к единому формату: hex-строка в нижнем регистре с префиксом `0x` и без лишних лидирующих нулей (через `BigInt`). Это критично для корректной работы подсветки патчей и выделения строк.

## 3. Компоненты Интерфейса

### 3.1. Layout и Views (`App.jsx`)
В v0.0.7 реализована система переключения видов:
*   **CPU View**: Стандартный вид. Содержит `DisassemblyPane` (код), `RegistersPane` (регистры), `InfoPane` (подсказки), а также плейсхолдеры для Dump и Stack.
*   **System Log View**: Полноэкранный компонент `SystemLogWindow`. Активируется через меню, тулбар или просмотр логов. Перекрывает собой CPU View.

### 3.2. DisassemblyPane (`components/DisassemblyPane.jsx`)
Компонент отрисовки листинга.
*   **Pre-fetching (Бесконечный скролл)**: При прокрутке до верхней или нижней границы компонент автоматически запрашивает у бэкенда код по смещенному адресу (используя `offsetAddress` с отрицательными значениями для скролла вверх).
*   **Отрисовка строк**: Делегирована компоненту `DisassemblyRow`.
*   **Форматирование**: Использует `utils/asmFormatter.js` для парсинга инструкций, применения настроек кейсинга (upper/lower), форматирования чисел (hex/dec) и подмены аргументов (Swap Arguments).

### 3.3. GotoModal (`components/GotoModal.jsx`)
Поддерживает переход как по адресу, так и по имени регистра.
*   Использует карту `REG_NAMES` для разрешения имен (например, `rax` -> значение регистра R0).
*   Валидирует ввод перед закрытием.

## 4. Жизненный цикл операции Патчинга
1.  Пользователь вызывает "Fill with byte" -> `useMemory`.
2.  `useMemory` отправляет POST `/memory/write`.
3.  Бэкенд выполняет "Safe Patching" (см. backend logic).
4.  При успехе (200 OK), фронтенд получает подтверждение.
5.  `useMemory` диспатчит `markAddressModified`.
6.  `useMemory` вызывает `refreshDisassembly`, заставляя GDB пере-дизассемблировать измененный участок (например, байт `90` превращается в `nop`).
7.  `DisassemblyPane` перерисовывается. Строка получает проп `isModified=true`, `DisassemblyRow` красит её в красный цвет.