#!/bin/bash

# –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ
cleanup() {
    echo ""
    echo "üõë –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª Ctrl+C. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ —É–¥–∞–ª—è–µ–º volumes..."
    # –í—ã–ø–æ–ª–Ω—è–µ–º down —Å —É–¥–∞–ª–µ–Ω–∏–µ–º volumes
    docker compose down -v
    # –£–¥–∞–ª—è–µ–º dangling –æ–±—Ä–∞–∑—ã (–∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–∫–æ–ø–∏–ª–∏—Å—å –ø—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ)
    echo "‚úî –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö Docker –æ–±—Ä–∞–∑–æ–≤..."
    docker image prune -f
    exit 0
}

# –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º SIGINT (Ctrl+C) –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é cleanup
trap cleanup SIGINT SIGTERM

echo "–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ Web-Olly..."

# –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É –∏ —Å—Ç–∞—Ä—Ç.
# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–µ–¥–Ω–µ–º –ø–ª–∞–Ω–µ, —á—Ç–æ–±—ã –º—ã –≤–∏–¥–µ–ª–∏ –ª–æ–≥–∏.
docker compose up --build --force-recreate

# –≠—Ç–∞ —Å—Ç—Ä–æ–∫–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ docker compose –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å–∞–º (–Ω–µ –ø–æ Ctrl+C),
# –Ω–æ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –æ—Å—Ç–∞–≤–∏–º –≤—ã–∑–æ–≤ cleanup –∏ –∑–¥–µ—Å—å.
cleanup
